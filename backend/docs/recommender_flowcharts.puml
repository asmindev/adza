@startuml SVD_Collaborative_Filtering

title Algorithma SVD (Collaborative Filtering)

start
:Permintaan Rekomendasi Collaborative Filtering;
:Cek keberadaan user dan riwayat rating user;

if (User valid dan memiliki rating?) then (ya)
  if (Model SVD perlu dilatih?) then (ya)
    :Ambil semua rating dari database;
    :Buat dataset rating;
    if (Dataset valid?) then (ya)
      :Latih model SVD;
      :Simpan model SVD;
      :Update timestamp pelatihan;
    else (tidak)
      #pink:Log error: Dataset tidak valid;
      stop
    endif
  else (tidak)
    :Muat model SVD yang sudah ada;
    if (Model berhasil dimuat?) then (tidak)
      #orange:Log: Model gagal dimuat, melatih model baru;
      :Ambil semua rating dari database;
      :Buat dataset rating;
      :Latih model SVD;
      :Simpan model SVD;
      :Update timestamp pelatihan;
    endif
  endif

  :Ambil semua makanan dari database;
  :Filter makanan yang belum diberi rating oleh user;

  :Prediksi rating untuk masing-masing makanan;
  if (Prediksi berhasil?) then (ya)
    :Urutkan makanan berdasarkan predicted rating;
    :Ambil top-N makanan;
    :Kembalikan hasil rekomendasi;
  else (tidak)
    #orange:Log: Gagal memprediksi, gunakan memory-based CF;
    :Hitung similarity antar user menggunakan korelasi Pearson;
    :Prediksi rating berdasarkan weighted average dari user mirip;
    :Urutkan makanan dan ambil top-N rekomendasi;
    :Kembalikan hasil rekomendasi;
  endif
else (tidak)
  #pink:Log: User tidak valid atau belum memiliki rating;
  :Kembalikan list kosong;
endif

stop

@enduml

@startuml TFIDF_Content_Based

title Algoritma TF-IDF (Content-Based)

start
:Permintaan Rekomendasi Content-Based;
:Cek riwayat rating dan review dari user;

if (User memiliki rating dan review?) then (ya)
  :Ambil makanan yang sudah diberi rating oleh user;
  :Ambil teks review dari makanan yang sudah direview user;

  if (Matriks TF-IDF perlu dibangun?) then (ya)
    :Ambil semua review makanan;
    :Lakukan preprocessing teks;
    :Bangun matriks TF-IDF;
    :Simpan matriks dan vectorizer;
    :Update timestamp pelatihan jika belum ada;
  else (tidak)
    :Muat matriks TF-IDF yang sudah ada;
    if (Matriks berhasil dimuat?) then (tidak)
      #orange:Log: Matriks gagal dimuat, membangun matriks baru;
      :Ambil semua review makanan;
      :Lakukan preprocessing teks;
      :Bangun matriks TF-IDF;
      :Simpan matriks dan vectorizer;
    endif
  endif

  :Gabungkan teks review user menjadi profil preferensi;
  :Transformasi profil user menggunakan vectorizer TF-IDF;

  if (Transformasi berhasil?) then (ya)
    :Hitung cosine similarity antara profil user dan semua makanan;
    :Filter makanan yang sudah diberi rating oleh user;
    :Urutkan makanan berdasarkan similarity score;
    :Ambil top-N makanan;
    :Kembalikan hasil rekomendasi;
  else (tidak)
    #orange:Log: Transformasi gagal, gunakan fallback;
    :Bangun matriks TF-IDF baru dengan metode on-the-fly;
    :Hitung similarity dan ambil top-N rekomendasi;
    :Kembalikan hasil rekomendasi;
  endif
else (tidak)
  #pink:Log: User belum memiliki rating atau review;
  :Kembalikan list kosong;
endif

stop

@enduml

@startuml Hybrid_Recommender

title Algoritma Hybrid Recommender

start
:Permintaan Rekomendasi Hybrid;
:Cek keberadaan user;

if (User valid?) then (ya)
  if (alpha == 1.0?) then (ya)
    :Dapatkan rekomendasi dari Collaborative Filtering saja;
  else (tidak)
    :Dapatkan rekomendasi dari Collaborative Filtering;
    :Dapatkan rekomendasi dari Content-Based;

    if (Kedua rekomendasi tersedia?) then (ya)
      :Gabungkan hasil rekomendasi;
      :Hitung hybrid score: alpha * CF_score + (1-alpha) * CB_score;
    else (tidak)
      if (Rekomendasi CF tersedia?) then (ya)
        #orange:Log: CB tidak tersedia, gunakan CF saja;
        :Gunakan rekomendasi CF;
      else (tidak)
        if (Rekomendasi CB tersedia?) then (ya)
          #orange:Log: CF tidak tersedia, gunakan CB saja;
          :Gunakan rekomendasi CB;
        else (tidak)
          #pink:Log: Kedua rekomendasi tidak tersedia;
          :Kembalikan list kosong;
          stop
        endif
      endif
    endif
  endif

  :Urutkan makanan berdasarkan hybrid/final score;
  :Ambil top-N rekomendasi;
  :Kembalikan hasil rekomendasi;
else (tidak)
  #pink:Log: User tidak valid;
  :Kembalikan null;
endif

stop

@enduml

@startuml Scheduled_Training

title Pelatihan Terjadwal Recommender System

start
:Inisiasi pelatihan terjadwal;
:Train model SVD (force=True);
:Build matriks TF-IDF (force=True);
:Update timestamp pelatihan;
:Selesai pelatihan terjadwal;
stop

@enduml
